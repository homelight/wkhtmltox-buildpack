#!/usr/bin/env bash
# bin/compile <build-dir> <cache-dir>

set -e
#set -o pipefail

BUILD_DIR=$1
CACHE_DIR=$2

BIN_DIR=$(cd $(dirname $0); pwd) # absolute path
OPT_DIR=$(cd "$BIN_DIR/../opt"; pwd)

WKHTML_TO_PDF="wkhtmltopdf"
#WKHTML_TO_IMAGE="wkhtmltoimage"

mkdir -p "$1/bin"

echo "-----> Unpacking wkhtmltopdf"
dpkg -x "$OPT_DIR/$WKHTML_TO_PDF" "$1/bin/$WKHTML_TO_PDF"

echo "-----> Building runtime environment"
chmod +x "$1/bin/$WKHTML_TO_PDF"
#chmod +x "bin/$WKHTML_TO_IMAGE"

#mkdir -p .profile.d
#echo "PATH=$PATH:$HOME/bin" > .profile.d/wkhtmltox.sh
exit 0